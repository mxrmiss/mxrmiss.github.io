---
title: 数据库
tag: 
- [Mysql]
- [SQL]
- [数据库]
categories:
- 数据库
---

# 数据库的学习

- [相关视频链接](https://www.bilibili.com/video/BV12b411K7Zu/?p=28)

## 数据库及其概念

- DB 数据库
- DBMS 数据库管理系统，如Mysql， MongoDB 等，用来管理与操作DB
- SQL  管理数据库的语言，几乎被所有的DBMS支持
- DB是大宅子，DBMS是宅子管家，SQL是管家的指挥口令

<!--more-->

### 数据库管理的特点

1. 先将数据放到 “一张表” 中， 在将表放到仓库中
2. 一个数据库中存放多张表，每张表都有自己独特的名字，用来标识自己
3. 数据库中的每张表都有自己的类别，有自己的门派，参照python的  “类”
4. 表是由列组成，也称为字段，相当与python中的  “属性”
5. 表是按行储存的，每一行相当与python中的  ”对象“

- 端口号port 3306

### Linux 系统 Mysql 相关事项

- 检查电脑是否存在Mysql ：whereis mysql  或者输入  mysql --version

- systemctl start mysql.service 启动  或者 service mysql start
  systemctl stop mysql.service 停止  或者 service mysql stop 
  systemctl restart mysql.service 重启
- 检查电脑是否启动或关闭数据库：ps aux | grep mysqld  或者  pidof mysqld
 [相关检查操作链接](https://blog.csdn.net/qq_31083947/article/details/90248565)

### 数据库常用命令

1. 进入管理系统时时查看有那些数据库

```
show databases;
```

2. 进入库

```
use 库的名称;
```

3. 查看库里有哪些表

```
show tables;
```

4. 从现在所在的库中查看别的库中存有的表

```
show tables from 库的名称;
```

5. 查看现在在哪个库

```
select database();
```

6. 查看表的内容

```
desc 表的名称;
```

7. 创建表

```
create table 表名（
	列名 列类型，
	列名 列类型，
	...
)
```



### SQL语法规范

1. 不区分大小写，但建议关键字大写，表名，列名小写
2. 每行命令u最好用分号结尾
3. 每行命令根据需要，可以进行缩进，或换行
4. SQL语法中索引从1开始
5. 注释 

- 单行注释：#注释文字
- 单行注释：-- 注释文字（注意横杠后面有空格）
- 多行注释：/× 注释文字 ×/

### 使用 DBMS 图形化界面以及命令行登录时出现错误解决

- [原文链接](https://www.cnblogs.com/leolztang/p/5094930.html)

```
~$ mysql -u root -p
Enter password: 
ERROR 1698 (28000): Access denied for user 'root'@'localhost'
```

- 解决

```
# 强制登录
sudo mysql

select user, plugin from mysql.user;

update mysql.user set authentication_string=PASSWORD('hero1314'), plugin='mysql_native_password' where user='root';

flush privileges;

sudo service mysql restart
```



## 数据库语言的学习

### DQL语言的学习

#### 基础查询

- 语法

```
select 查询列表 from 表名;
```

- 特点：

1. 查询列表可以是：表中的字段，常量值，表达式，函数
2. 查询结果是一个虚拟的表格，只是将结果用表格呈现出来而已

- 查询字段

```
select 字段一，字段二 from 表格;    //字段之间用逗号隔开
select * from 表格;  // 查询所有字段
```

- 着重号 `  （1的旁边的那个），用来标识字段

- 查询常量值：select ' 字符或字符串 ’ ;

- 起别名

  ​	别名有空格时，应用空格将别名括起来
  
  ​	注意：如果为表起了别名，则查询的字段就不能使用原来的表名去限定 

```
select 字段值 as 别名;  // as可以省略
```

- 去重：在被查询的字段之前加上关键字 distinct
- \+ 号的作用

```
select 100+90; // 俩个操作数都为数值型，则做加法运算
# 结果：190
select '100'+90;  // 俩个数中若有一方为字符串，则将进行转换，若转换成功，则将继续做加法运算，若转换失败，则将字符型数值转换成再在进行加法运算
# 结果：190
select null+10; //若有一个方为null，则结果肯定为null
```



- ifnull( ) 函数

```
select IFNULL(字段，0) as 别名; //若该字段真未NULL，则输出0,否则则输出该字段的值
```



#### 条件查询

- 语法：

```
select 查询列表 from 表名 where 筛选条件;
```

- 分类：

1. 按表达条件筛选：

   ​		逻辑运算符：> , <, =, <> , <=, >=

   ​		注意：<>为不等于的意思

2. 按逻辑表达式筛选：

   ​		&&， ||， ！

   ​		and，or，not   // SQL推荐使用

3. 模糊查询

   ​		like, between and, in, is null

   - between and 等价与  >=  and <=

   模糊查询通常与通配符一起使用  (in 不支持)

   - 常见通配符：% 匹配任意一个或零个

     ​					 _  (下划线) 匹配任意一个

     - 支持对通配符进行转义

```
select 字段 from 表名 where like '_$_' escape '$'; //使用$符号对下划线进行转义
```

```
select × from 表名 where like %a%;
```

4. 安全等于  <=> : 可以判断显示NULL



#### 排序查询

- 语法：

```
select 字段
from 表
where 筛选条件
order by 排序列表 asc|desc   //不写关键字，默认是asc
# asc 从低到高 （升序）
# desc 从高到底 （降序）
```

- 支持别名排序， 运算表达式排序
- 支持对多个列表进行先后排序查询，列表间用逗号隔开
- 排序语句一般是放在查询语句的最后面



#### 常见函数

- 类似python中的方法
- 函数可以嵌套使用
- 分类：

1. 单行函数：concat, length, ifnull等
2. 分组函数：
   + 功能：做统计使用，又称为统计函数，聚合函数，组函数

##### 单行函数

###### 一、字符函数

1. length 

```
select length('str');
```

2. concat ( ) 拼接函数

```
concat(str1, str2 ,..., str n); //拼接字符串字段进行查询，字段之间用逗号隔开
# 若str中有值为NULL，则查询的所有值为NULL
```

3. upper( ), lower( ) :改变大小写

4. substr( ) ：截取字符函数

```
select substr('今天买了个大白菜'， 6);
结果: 大白菜
select substr('今天买了个大白菜'， 3, 4);
结果: 买了
```

5. instr( ) :返回字串第一个字符的索引，没有则返回0

```
select instr('今天买了个大白菜'， '大白菜');
结果：6
```

6. trim( ) :去掉字段中的空格或指定字符

```
select trim('烂的' from '今天买了个烂的大白菜');
结果：今天买了个大白菜
```

7. lpad( ): 左填充指定长度的字符，

   rpad( ): 右填充指定长度的字符

```
select ipad('大白菜', 6, '*');
结果：×××大白菜
select rpad('大白菜', 6, '*');
结果：大白菜×××
```

8. replace 替换

```
select replace('今天买了个大白菜', '大白菜', '胡萝卜');
结果：今天买了个胡萝卜
```

###### 二、数学函数

1. round( ) : 四舍五入函数

```
select round(1.1236);  //默认保留整数部分
结果：1
select round(1.1236, 3);  //可指定保留小数部分
结果：1.124
```

2. ceil( ): 向上取整，返回 >= 该函数的最小整数
3. floor( ): 向下取整，返回  <= 该函数的最大整数

```
select floor(-9.99);
结果：-10
```

4. truncate 截断函数，截断小数点后指定的位数

```
select truncate(1.123, 2);
结果：1.12
```

5. mod( ): 取模（取余）函数

```
select mod(10,3);
结果：1
```

###### 三、日期函数

1. now( ) 返回当前系统日期+时间
2. curdate( ) 返回当前系统日期，不返回时间
3. curtime( ) 返回当前时间，不返回日期
4. str_to_date( ) 将日期格式的字符转换成指定格式的日期
5. date_format( ) 将日期转换成字符

- 更多日期函数请上网搜索

###### 四、流程控制函数

1. if( ) :该函数起到的作用类似与python或C语言中的else if( )函数
2. case( )： 

```
case 要判断的字段或表达式    // 选择函数——判断并选择显示一个
when 常量1 then 要显示的值1或语句1;  //如果显示的是值，则不显示分号 
when 常量2 then 要显示的值2或语句2;
...
else 默认显示的值或语句
end
```

```
case
when 常量1 then 要显示的值1或语句1;  //如果显示的是值，则不显示分号 
when 常量2 then 要显示的值2或语句2;
...
else 默认显示的值或语句
end
```

###### 五、其它函数

- 其他函数太多，用时上网搜

##### 分组函数

- 功能：用作统计使用，又称为聚合函数或统计函数或组函数
- 分类：sum 求和， avg 平均值， max， min， count 计算个数
- 忽略 NULL值
- 可以与distinct( )去重函数或其它函数搭配使用
- count( )详细介绍

```
select count(*) from 表单;  //统计总行数
```

- 和分组函数一同查询的字段要求是group by后的字段

#### 分组查询

1. 语法：

```
select 分组函数，列（要求出现在group by的后面）
from 表
[where 筛选条件]
group by 分组的列表;
[order by 子句]

// 查询列表必须特殊，要求是分组函数和group by 后出现的字段
```

- 简单的分组查询

1. 实例一：查询每个工种的最高工资

```
select max(salary), job_id
from employees
group by job_id;
```

3. 实例二：查询每个位置上的部门个数

```
select count(*), location_id
from departments
group by lacation_id;
```

- 添加筛选条件的分组查询

4. 实例三：查询邮箱中包含a字符的，每个部门的平均工资

```
select avg(salsry), department_id
from employees
where email '%a%'
group by department_id;
```

5. 实例四：查询有奖金的每个领导手下员工的最高工资

```
select max(salary), manager_id
from employees
where commission_pct is ont null
group by manager_id;
```

- 添加复杂筛选条件的分组查询
- 分组后进行条件筛选的查询

6. 实例五：查询哪个部门的员工个数>2

```
select count(*), depatment_id
from employees
group by department_id
having count(*)>2;
```

#### 连接查询

1. 含义：又称多表查询，当查询的字段来自于多个表时，就会用到连接查询

2. 笛卡尔乘积现象：表1有m行，表2有n行，结果有m×n行

   1. 发生原因：没有有效的链接条件
   2. 如何避免：添加有效的连接条件

3. 按功能分类：

   - 内连接：等值连接

     ​				非等值连接

     ​				自连接

   - 外连接：左外连接

     ​				右外连接

     ​				全外连接

   - 交叉连接

(1) 等值查询

- 查询员工名和对应的部门名

```
select last_name, department_name
from employees, departments
where employees.'department_id=departments.'department_id';
```

- 多条件筛选连接查询
  - 查询有奖金的员工名，部门名

```
select last_name, department_name, commission_pct
from emplloees e, departments d
where e.'department_id'=d.'department_id'
and e.'commission_pct' is not null;
```

(2) 非等值链接















